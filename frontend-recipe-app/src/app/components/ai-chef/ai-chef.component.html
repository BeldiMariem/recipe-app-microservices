<div class="ai-chef-page">
    <div class="ai-chef-header">
        <div class="container">
            <div class="header-content">
                <div class="header-info">
                    <h1 class="title">
                        <i class="bi bi-magic"></i>
                        AI Chef Assistant
                        <span class="premium-badge">
                            <i class="bi bi-stars"></i>
                            Premium
                        </span>
                    </h1>
                    <p class="subtitle">
                        Let our AI chef create personalized recipes based on your preferences and pantry items
                    </p>
                </div>

                <div class="header-stats" *ngIf="stats">
                    <div class="stat-box">
                        <i class="bi bi-check-circle"></i>
                        <span>{{ stats.generatedRecipes }} Recipes Generated</span>
                    </div>
                    <div class="stat-box">
                        <i class="bi bi-clock-history"></i>
                        <span>{{ stats.avgTime }}min Avg Time</span>
                    </div>
                    <div class="stat-box">
                        <i class="bi bi-basket"></i>
                        <span>{{ stats.ingredientsUsed }} Ingredients Used</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="ai-chef-content">
            <div class="generation-cards">
                <div class="card-section">
                    <h2><i class="bi bi-sliders"></i> Custom Generation</h2>
                    <p class="section-description">
                        Create recipes with specific criteria and preferences
                    </p>

                    <div class="generation-card advanced" (click)="openCustomModal()">
                        <div class="card-icon custom">
                            <i class="bi bi-sliders"></i>
                        </div>
                        <div class="card-content">
                            <h3>Custom Recipe Generator</h3>
                            <p>Generate recipes with specific meal type, difficulty, time, and more</p>
                            <div class="card-tags">
                                <span class="tag">Custom</span>
                                <span class="tag">Flexible</span>
                                <span class="tag">Detailed</span>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-outline">
                                <i class="bi bi-gear"></i>
                                Configure
                            </button>
                        </div>
                    </div>
                </div>

            </div>

            <div *ngIf="generatedRecipes.length > 0" class="ai-recipes-section">
                <div class="section-header">
                    <div class="header-left">
                        <h2>
                            <i class="bi bi-egg-fried"></i>
                            Generated Recipes
                            <span class="badge">{{ generatedRecipes.length }}</span>
                        </h2>
                        <p class="section-subtitle">
                            Based on your preferences and pantry items
                        </p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-outline" (click)="saveAllRecipes()" [disabled]="isSaving">
                            <i class="bi bi-download"></i>
                            {{ isSaving ? 'Saving...' : 'Save All' }}
                        </button>
                        <button class="btn btn-outline danger" (click)="clearRecipes()">
                            <i class="bi bi-trash"></i>
                            Clear All
                        </button>
                    </div>
                </div>

                <div class="confidence-filter">
                    <div class="filter-label">
                        <i class="bi bi-funnel"></i>
                        Filter by Confidence:
                    </div>
                    <div class="filter-buttons">
                        <button class="filter-btn" [class.active]="confidenceFilter === 'all'"
                            (click)="setConfidenceFilter('all')">
                            All Recipes
                        </button>
                        <button class="filter-btn high" [class.active]="confidenceFilter === 'high'"
                            (click)="setConfidenceFilter('high')">
                            High Confidence (80%+)
                        </button>
                        <button class="filter-btn medium" [class.active]="confidenceFilter === 'medium'"
                            (click)="setConfidenceFilter('medium')">
                            Medium (50-79%)
                        </button>
                        <button class="filter-btn low" [class.active]="confidenceFilter === 'low'"
                            (click)="setConfidenceFilter('low')">
                            Low (Below 50%)
                        </button>
                    </div>
                </div>

                <div class="recipes-grid">
                    <div *ngFor="let recipe of filteredRecipes" class="ai-recipe-card">
                        <div class="recipe-header">
                            <div class="confidence-badge" [ngClass]="{
                                     'high': recipe.highConfidence,
                                     'medium': recipe.mediumConfidence,
                                     'low': recipe.lowConfidence
                                 }">
                                <i class="bi bi-check-circle"></i>
                                {{ (recipe.confidenceScore * 100) | number:'1.0-0' }}% Match
                            </div>

                            <div class="recipe-actions">
                                <button class="icon-btn" (click)="toggleRecipeDetails(recipe)" title="View Details">
                                    <i class="bi"
                                        [class]="recipe.showDetails ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                                </button>
                            </div>
                        </div>

                        <div class="recipe-content">
                            <h3 class="recipe-title">{{ recipe.title }}</h3>

                            <div class="recipe-meta">
                                <div class="meta-item">
                                    <i class="bi bi-clock"></i>
                                    {{ recipe.preparationTime }} min
                                </div>
                                <div class="meta-item">
                                    <i class="bi bi-people"></i>
                                    {{ recipe.servings }} servings
                                </div>
                                <div class="meta-item difficulty" [ngClass]="recipe.difficulty">
                                    <i class="bi" [class]="getDifficultyIcon(recipe.difficulty)"></i>
                                    {{ recipe.difficulty | titlecase }}
                                </div>
                                <div class="meta-item">
                                    <i class="bi bi-globe"></i>
                                    {{ recipe.cuisine }}
                                </div>
                            </div>

                            <p class="recipe-description">{{ recipe.description }}</p>

                            <div *ngIf="recipe.missingIngredients.length > 0" class="missing-ingredients">
                                <div class="missing-header">
                                    <i class="bi bi-exclamation-triangle"></i>
                                    <span> Missing </span> <span>{{ recipe.missingIngredients.length }} </span> <span>
                                    </span> <span>ingredients</span>
                                </div>
                                <div class="missing-list">
                                    <span *ngFor="let ingredient of recipe.missingIngredients" class="missing-item">
                                        {{ ingredient }}
                                    </span>
                                </div>
                            </div>

                            <!-- Recipe Details (Collapsible) -->
                            <div *ngIf="recipe.showDetails" class="recipe-details">
                                <div class="details-section">
                                    <h4><i class="bi bi-list-check"></i> Ingredients</h4>
                                    <ul class="ingredients-list">
                                        <li *ngFor="let ingredient of recipe.ingredients">
                                            <span class="ingredient-name">{{ ingredient.name }}</span>
                                            <span class="ingredient-quantity">
                                                {{ ingredient.quantity }} {{ ingredient.unit }}
                                            </span>
                                        </li>
                                    </ul>
                                </div>

                                <div class="details-section">
                                    <h4><i class="bi bi-list-ol"></i> Instructions</h4>
                                    <ol class="instructions-list">
                                        <li *ngFor="let instruction of recipe.instructions; let i = index">
                                            {{ instruction }}
                                        </li>
                                    </ol>
                                </div>

                                <div class="details-actions">
                                    <button class="btn btn-primary" (click)="saveRecipe(recipe)">
                                        <i class="bi bi-save"></i>
                                        Save Recipe
                                    </button>
                                    <button class="btn btn-outline" (click)="shareRecipe(recipe)">
                                        <i class="bi bi-share"></i>
                                        Share
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="recipe-footer">
                            <button class="btn btn-primary" (click)="saveRecipe(recipe)">
                                <i class="bi bi-save"></i>
                                Save
                            </button>
                            <button class="btn btn-outline" (click)="toggleRecipeDetails(recipe)">
                                {{ recipe.showDetails ? 'Hide Details' : 'View Details' }}
                            </button>
                        </div>
                    </div>
                </div>

                <div *ngIf="filteredRecipes.length === 0" class="empty-state">
                    <i class="bi bi-filter-circle"></i>
                    <h3>No recipes match your filter</h3>
                    <p>Try changing your confidence filter to see more recipes</p>
                    <button class="btn btn-outline" (click)="setConfidenceFilter('all')">
                        Show All Recipes
                    </button>
                </div>
            </div>

            <div *ngIf="generatedRecipes.length === 0 && !isLoading" class="empty-state main-empty">
                <div class="empty-icon">
                    <i class="bi bi-magic"></i>
                </div>
                <h3>No Recipes Generated Yet</h3>
                <p>Start by clicking one of the generation options above to create your first AI recipe!</p>
                <div class="empty-actions">
                    <button class="btn btn-primary" (click)="getQuickSuggestions()">
                        <i class="bi bi-lightning-charge"></i>
                        Get Quick Suggestions
                    </button>
                    <button class="btn btn-outline" (click)="openCustomModal()">
                        <i class="bi bi-sliders"></i>
                        Custom Generation
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="showCustomModal" class="modal-overlay" (click)="closeCustomModal()">
        <div class="modal-content large-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>
                    <i class="bi bi-magic"></i>
                    Custom Recipe Generator
                </h3>
                <button class="modal-close" (click)="closeCustomModal()">
                    <i class="bi bi-x"></i>
                </button>
            </div>

            <div class="modal-body">
                <form [formGroup]="generationForm" (ngSubmit)="generateCustomRecipes()">
                    <div class="form-sections">
                        <div class="form-section">
                            <h4><i class="bi bi-gear"></i> Basic Preferences</h4>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="mealType">Meal Type</label>
                                    <select id="mealType" formControlName="mealType" class="form-control">
                                        <option value="">Any Type</option>
                                        <option value="breakfast">Breakfast</option>
                                        <option value="lunch">Lunch</option>
                                        <option value="dinner">Dinner</option>
                                        <option value="dessert">Dessert</option>
                                        <option value="snack">Snack</option>
                                        <option value="appetizer">Appetizer</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="cuisine">Cuisine</label>
                                    <select id="cuisine" formControlName="cuisine" class="form-control">
                                        <option value="">Any Cuisine</option>
                                        <option value="italian">Italian</option>
                                        <option value="mexican">Mexican</option>
                                        <option value="asian">Asian</option>
                                        <option value="indian">Indian</option>
                                        <option value="mediterranean">Mediterranean</option>
                                        <option value="american">American</option>
                                        <option value="french">French</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="difficulty">Difficulty Level</label>
                                    <select id="difficulty" formControlName="difficulty" class="form-control">
                                        <option value="">Any Difficulty</option>
                                        <option value="easy">Easy</option>
                                        <option value="medium">Medium</option>
                                        <option value="hard">Hard</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4><i class="bi bi-clock"></i> Time & Servings</h4>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="maxTime">Max Preparation Time (minutes)</label>
                                    <div class="range-input">
                                        <input type="range" id="maxTime" min="5" max="240" step="5"
                                            formControlName="maxTime" class="range-slider">
                                        <div class="range-value">{{ generationForm.value.maxTime }} min</div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="servings">Servings</label>
                                    <div class="range-input">
                                        <input type="range" id="servings" min="1" max="12" step="1"
                                            formControlName="servings" class="range-slider primary">
                                        <div class="range-value">{{ generationForm.value.servings }} people</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4><i class="bi bi-basket"></i> Ingredients Options</h4>

                            <div class="form-check-group">
                                <div class="form-check">
                                    <input type="checkbox" id="usePantry" formControlName="usePantry"
                                        class="form-check-input">
                                    <label for="usePantry" class="form-check-label">
                                        Use ingredients from my pantry
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" (click)="closeCustomModal()">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary" [disabled]="isGenerating">
                            <span *ngIf="!isGenerating">
                                <i class="bi bi-magic"></i>
                                Generate Recipes
                            </span>
                            <span *ngIf="isGenerating">
                                <i class="bi bi-hourglass-split"></i>
                                Generating...
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div *ngIf="isLoading || isGenerating" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>{{ isLoading ? 'Finding Recipes...' : 'Generating Recipes...' }}</h3>
            <p>Our AI chef is working its magic</p>
        </div>
    </div>
</div>